{% extends 'form/fieldset/user_billing.html.twig' %}

{% block form_user_billing_country %}
    {{ parent() }}

    {% if oViewConf.isCheckoutNonKlarnaCountry() and oView.getIsOrderStep()  %}
        {% capture assign = "otherCountry" %}
            <div class="col-lg-2">
                <button type="button"
                        class="btn btn-default js-other-country">{{ translate({ ident: "TCKLARNA_OTHER_COUNTRY" }) }}</button>
            </div>
        {% endcapture %}
        <script type="text/javascript">
            var otherCountryButton = '{{ otherCountry|trim|escape("javascript") }}';
        </script>
        {% capture assign = "dataCollectionJS" %}
            function decodeEntities(encodedString) {
            var textArea = document.createElement('textarea');
            textArea.innerHTML = encodedString;
            return textArea.value;
            }

            $('.js-other-country').on('click', function(){
            $form = $(this).closest('form');
            $form.find('input[name="fnc"]').val('klarnaResetCountry');
            $form.find('input[name="cl"]').val('user');
            var formdata = $form.serialize();
            $.post($form.attr('action'), formdata, function(url){
            window.location.href = decodeEntities(url);
            });
            });
        {% endcapture %}

        {{ script({ add='var: add='var, dropdown: dropdown, ("#invCountrySelect").parent();: ("#invCountrySelect").parent();, dropdown.removeClass("col-lg-9").addClass("col-lg-7");: dropdown.removeClass("col-lg-9").addClass("col-lg-7");, var: "var", otherCountry: otherCountry, .parseHTML(otherCountryButton);: .parseHTML("otherCountryButton");, dropdown.parent().append($otherCountry);: dropdown.parent().append(otherCountry);', priority: 10, dynamic: __oxid_include_dynamic }) }}
            {{ script({ add: dataCollectionJS, priority: 10, dynamic: __oxid_include_dynamic }) }}
    {% endif %}
{% endblock %}